<!--@Author 卞秦豫-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" href="favicon.ico">
    <link rel="Shortcut Icon" href="favicon.ico"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css"/>
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">

    <!--/meta 作为公共模版分离出去-->

    <title>灵活报表管理系统</title>
    <meta name="keywords" content="H-ui.admin v3.0,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
    <meta name="description" content="H-ui.admin v3.0，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <script src="/layui/layui.js" charset="utf-8"></script>

    <style>
        #changesize {
            font-size: xx-large;
        }

        #menu-product {
            display: inline;
        }

        tr {
            height: 30px;
            font-size: 30px;
            text-align: center;
        }
    </style>
    <script>
        $(document).ready(function () {
            $(".bodyonline").hide();
            $(".bodyoffline").hide();
            $(".but_offline").click(function () {
                $(".bodyonline").hide();
                $(".bodyoffline").toggle();
            });
            $(".but_online").click(function () {
                $(".bodyoffline").hide();
                $(".bodyonline").show();
            });
        });
    </script>

</head>
<body>
<div class="headerpage"></div>
<div class="dislpayArrow hidden-xs">
    <a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a>
</div>
<section class="Hui-article-box">
    <nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页
        <span class="c-gray en">&gt;</span> 填写表单信息
        <span class="c-gray en">&gt;</span>填写表单
        <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px"
           href="javascript:location.replace(location.href);" title="刷新">
            <i class="Hui-iconfont">&#xe68f;</i>
        </a>
    </nav>
    <div class="Hui-article">
        <article class="cl pd-20">
            <!--填充数据-->
            <form enctype="multipart/form-data">
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-9">
                        <div style=" margin-bottom: 20px; margin-top: 20px;">
                            <label class="form-label col-xs-6 col-sm-2">选择表名：</label>
                            <select class="input-text" style="width: 30%;" name="TableName" id="orgnize"
                                    placeholder="请选择报表">
                                <option th:each="reportInfo : ${reportLists}" th:value="${reportInfo.reportId}"
                                        th:text="${reportInfo.reportName}"></option>
                            </select>
                            <input type="hidden" value="" name="reportId" id="reportId"/>
                            <input type="hidden" value="" name="reportName" id="reportName"/>
                            <a href="javascript:;"  class="btn btn-primary radius show" id="downLoad" style="margin-left: 30px">
                            <i class="Hui-iconfont">&#xe640;</i> 下载模板</a>
                            <!--<input class="btn btn-success radius" style="margin-left: 23px" type="button" id="downLoad"-->
                                   <!--value="下载模板">-->
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3" style="margin-left: 30px"></div>
                    <div class="col-sm-3">
                        <a href="javascript:;" class="btn btn-primary radius but_offline">
                            <i class="Hui-iconfont">&#xe600;</i> 离线上传</a>
                    </div>
                    <div class="col-sm-2">
                        <a href="javascript:;" id="online" class="btn btn-primary radius but_online" style="margin-left: 8px">
                            <i class="Hui-iconfont">&#xe600;</i> 在线填写</a>
                    </div>
                </div>
                <div class="row bodyoffline">
                    <div class="col-sm-9 " style="margin-left: 28%;margin-top: 20px">
                        <!--<div class="bodyoffline" style="margin-top: 20px;">-->
                            <input type="file" name="file" id="file" style="margin-right: 4px">
                            <button type="button" id="upload" class="btn btn-success radius" style="width: 100px;">上传</button>
                        <!--</div>-->
                    </div>
                </div>
                <div class="row" style="margin-left: 50px;" >
                    <!--<div class="col-sm-1"></div>-->
                    <div class="col-sm-11" style="margin-top: 10px">
                        <table class="layui-hide" id="preview"></table>
                    </div>
                </div>
            </form>
        </article>
    </div>
</section>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.page.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<!--<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script>-->
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="application/javascript">
    $(function () {
        $(".headerpage").load("/top");
    });
    layui.use(['table'], function () {
        var reportId;
        var preview = null;
        var table = layui.table;
        reportId = $("#orgnize").get(0).selectedIndex = 1;
        $("#orgnize").val(reportId);
        $("#reportId").val(reportId);
        showTable(reportId);
        $("#orgnize").on("change", function () {
            var seled = $(this).val();
            $("#reportId").val(seled);
            reportId = $("#reportId").val();
            showTable(reportId);
        });

        function showTable(reportId) {
            var colNames = [];
            //动态获取列信息
            $.ajax({
                type: "post",
                url: "/getColNames",
                data: {"reportId": reportId},
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        colNames[i] = {field: 'col' + data[i].colLoc, title: data[i].colName};
                    }
                    preview = null;
                    preview = table.render({
                        elem: '#preview',
                        cellMinWidth: 100,
                        method: 'post'
                        , url: '/leaderShowFinalReport?reportId=' + reportId // 数据接口
                        , page: true // 开启分页
                        , cols: [colNames]
                    });
                    preview.reload();
                }
            });
        }

        $("#online").click(function () {
            table_add('添加表内容', '/tableInfo?reportId=' + reportId, '800', '500');
        });

        /*管理员-增加*/
        function table_add(title, url, w, h) {
            layer_show(title, url, w, h);
            preview.reload();
        }

        $('#downLoad').click(function () {
            if ($("#orgnize option").length==0){
                alert("无报表可下载");
                return;
            }
            var postData = {
                "reportId": $("#reportId").val()
            };
            $.ajax({
                type: "POST",
                url: "/excel/export",
                data: postData,
                success: function (data) {
                    if (data.code == "200") {
                        fileId = encodeURIComponent(data.data);
                        console.log(fileId);
                        window.location.href = "/get.do?id=" + fileId;
                    }
                    else {
                        $("#btn_login").attr("disabled", false);
                        $("#btn_login").val("登陆");
                        alert("用户或密码错误！");
                    }
                }
            });
        });

        $('#upload').click(function () {
            var formData = new FormData($('form')[0]);//获取表单序列化后的
            formData.append('file', $(':file')[0].files[0]);
            $.ajax({
                url: '/uploadExcel',
                type: 'POST',
                dataType: "json",
                data: formData,
                //这两个设置项必填
                contentType: false,
                processData: false,
                success: function (data) {
                    console.log(data);
                    if (data.msg != '上传失败') {
                        alert(data.msg);
                        preview.reload();
                    } else {
                        alert(data.msg);
                    }

                }
            })
        });
    });


</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>